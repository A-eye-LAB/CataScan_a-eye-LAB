## Catascan API 웹 프로젝트 개요

### 소개
해당 웹 프로젝트는 Catascan앱의 센터용 버전의 API를 구성하기 위한 자바(Java) 스프링(Spring Boot)어플리케이션이다. 
운영환경은 AWS EC2인스턴스 내에서 도커(Docker)와 쿠버네티스(Kubernetes)를 사용하여 운영하는 방향을 기준으로 한다. 
개발서버와 운영서버를 구분하는 것을 염두에 두고 구성하였다. 

### 아키텍쳐
1. **백엔드**: 도커 컨테이너로 작동하는 Java Spring Boot 어플리케이션
2. **데이터베이스**: AWS RDS Aurora(PostgreSQL) 인스턴스; 개발/테스트에서는 로컬 서버내 작동하는 PostgreSQL:16 도커 컨테이너다. 
3. **파일 저장**: AWS S3버킷으로 이미지를 저장하고 접근하게 된다. 개발단계에서는 로컬 서버 볼륨 내에 저장하는 방식을 채택하였다. 
4. **배포**: EC2인스턴스 위에서 동작하는 방식이고 쿠버네티스를 활용하였다. CI/CD를 고려하지 않아서 별도 도커 이미지 등록절차는 생략한다. 
5. **인증/인가**: PASETO(Platform-Agnostic Security Tokens)토큰을 활용하여 접근 제어를 한다. 
6. **로그/모니터링**: 서버 구성에 따라 Grafana와 Prometheus를 통해 확인할 수 있다. 작은 서버를 구성한다면 CloudWatch 사용을 권장한다. 

### 설치/실행 방법
설치 실행방법은 다음과 같다. 
1. **설치환경구성**: EC2인스턴스 내에 웹 어플리케이션 구동을 위한 도커, 쿠버네티스 등 패키지를 설치한다. 
2. **컨테이너화**: 해당 자바 코드를 도커 이미지로 빌드하여 활용하도록 한다. 
3. **쿠버네티스를 이용한 배포**:
4. **DB 설정 및 구성**: DB는 개발/테스트시에는 postgres:16 도커 이미지를 사용하였고, 운영서버에서는 RDS에서 Aurora(Postgres compatible)를 구성하여 사용하였다. DB 스키마는 문서 [DB부분](../../docs/web-admin/04_database.md)을 참고할 수 있다. 
5. **S3 버킷 설정 및 연계**: 
6. **스케일링**: 쿠버네티스로 구성하여 기본적으로 1개에서 출발하고 최대 3개의 레플리카까지 생성되도록 설정하였으나 EC2 인스턴스 타입에 따라 변동가능하다. 

### API 문서
OpenAPI 형식으로 [catascan_api_1.0_.yaml](../../docs/web-admin/catascan_api_1.0.yaml)에 모든 API 인터페이스가 예시와 함께 정의되어 있어 참고할 수 있다. 

### 어플리케이션 업데이트
- **롤링 업데이트**: 쿠버네티스가 롤링업데이트를 통해 다운타임을 최소화한다.
- **DB 마이그레이션**: 기본적으로 Spring Boot에서 Entity 클래스를 수정하면 연계된 DB가 그에 맞춰서 자동으로 수정된다. 다만 기존 데이터와 호환 및 변형에 따른 데이터 변경에 유의한다.


### 보안 관련 고려사항
- **환경변수**: 쿠버네티스를 활용하여 보안이 필요한 환경변수를 관리한다.
- **IAM**: IAM으로 EC2인스턴스와 S3 접근을 제어한다. 
- **네트워크 보안**: 보안그룹과 VPC를 통해 트래픽을 관리한다.
- **TLS 암호화**: 가급적 인증 등록을 통해 API는 HTTPS를 사용하도록 한다. 

### 로그/모니터링
- **Prometheus & Grafana**: 프로메테우스 서버로 접근하여 JMX를 포함한 정보를 실시간 모니터링이 가능하다. 
- **Alerting**: AWS CloudWatch를 통하거나 Prometheus를 이용해서 알람 기준치를 설정한다. 



